<html>
<head>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"></script>
<style>
#map {
      width: 800px;
      height: 500px;
    }
.info {
      padding: 6px 8px;
      font: 14px/16px Arial, Helvetica, sans-serif;
      background: white;
      background: rgba(255, 255, 255, 0.8);
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
      border-radius: 5px;
    }
    .info h4 {
      margin: 0 0 5px;
      color: #777;
    }
    .legend {
      text-align: left;
      line-height: 18px;
      color: #555;
    }
    .legend i {
      width: 18px;
      height: 18px;
      float: left;
      margin-right: 8px;
      opacity: 0.7;
</style>
</head>
<body>
<div id="map" > </div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

  <script src="puma-data.js" > </script>


  <script>


    var map = L.map("map").setView([37.8, -96], 4);
    L.tileLayer(
      "https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw",
      {
        maxZoom: 18,
        attribution:
          'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
          '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
          'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
        id: "mapbox.light"
      }
    ).addTo(map);
    // control that shows state info on hover
    var info = L.control();
    info.onAdd = function(map) {
      this._div = L.DomUtil.create("div", "info");
      this.update();
      return this._div;
    };
    info.update = function(props) {
      this._div.innerHTML =
        "<h4>US Population Density</h4>" +
        (props
          ? "<b>" +
            props.name +
            "</b><br />" +
            props.density +
            " people / mi<sup>2</sup>"
          : "Hover over a state");
    };
    info.addTo(map);
    // get color depending on population density value
    function getColor(d) {

      return d > 2800
        ? "#800026"
        : d > 2400
        ? "#BD0026"
        : d > 2000
        ? "#E31A1C"
        : d > 1600
        ? "#FC4E2A"
        : d > 1200
        ? "#FD8D3C"
        : d > 800 ? "#FEB24C"
        : d > 400 ? "#FED976"
        : "#FFEDA0";

    }
    function style(feature) {
      return {
        weight: 2,
        opacity: 1,
        color: "white",
        dashArray: "3",
        fillOpacity: 0.7,
        fillColor: getColor(feature.properties.sf_li_all)
      };
    }
    //THE CODE THAT I AM WRITING TO HAVE YOU BE
    // ABLE TO SELECT A STATE AND THEN SEE THE DISPALCEMENT
    // AMOUNTS OF OTHER PUMAS
    function viewData(e) {

      var layer = e.target;
      layer.setStyle({
        weight: 5,
        color: "#666",
        dashArray: "",
        fillOpacity: 0.7
      });
      if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
        layer.bringToFront();
      }
      info.update(layer.feature.properties);
    }
    var geojson;
    var lastclick = null;
    var selected = null;
    var selectedLayer = null;
    function selectState(e) {
      if (lastclick == null) {
        console.log("First Click", lastclick)
      } else {
      geojson.resetStyle(lastclick);
      info.update(geojson);
      console.log("second click", lastclick);
    }

      var layer = e.target;
      selected = e.target;
      lastclick = e.target;
      layer.setStyle({
        weight: 5,
        color: "#666",
        dashArray: "",
        fillOpacity: 0.7
      });
      if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
        layer.bringToFront();
      }
      info.update(layer.feature.properties);
      //map.fitBounds(e.target.getBounds());
      selectedLayer = layer;
    }


    function resetHighlight(e) {
      if (e.target != lastclick) {
      geojson.resetStyle(e.target);
      if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
        selectedLayer.bringToFront();
      }
      info.update(selectedLayer.feature.properties);
    }
    }

    // BACK TO NORMAL CODE
    function onEachFeature(feature, layer) {
      layer.on({
        mouseover: viewData,
        mouseout: resetHighlight,
        click: selectState
      });
      /*layer.on('click', function(e){
          if(lastclick) {
               geojson.resetStyle(e.target);
               info.update();
             }
          lastclick = e.target;
     });*/
    }
    geojson = L.geoJson(pumaData, {
      style: style,
      onEachFeature: onEachFeature
    }).addTo(map);

    map.attributionControl.addAttribution(
      'Population data &copy; <a href="http://census.gov/">US Census Bureau</a>'
    );
    var legend = L.control({ position: "bottomright" });
    legend.onAdd = function(map) {
      var div = L.DomUtil.create("div", "info legend"),
        //grades = [0, 10, 20, 50, 100, 200, 500, 1000],
        grades = [0, 400, 800, 1200, 1600, 2000, 2400, 2800],
        labels = [],
        from,
        to;
      for (var i = 0; i < grades.length; i++) {
        from = grades[i];
        to = grades[i + 1];
        labels.push(
          '<i style="background:' +
            getColor(from + 1) +
            '"></i> ' +
            from +
            (to ? "&ndash;" + to : "+")
        );
      }
      div.innerHTML = labels.join("<br>");
      return div;
    };
    legend.addTo(map);
  </script>
</body>
</html>
